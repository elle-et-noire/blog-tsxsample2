<!DOCTYPE html><html lang="ja"><head><meta property="og:type" content="website"/><meta property="og:site_name" content="lumieres/legeres"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><title>SvelteKit を使って jamband/tapes を作った · lumieres/legeres</title><meta name="description" content="jamband/tapes をリリースした。この記事では jamband/tapes の技術的なことについて書いていく。"/><meta property="og:title" content="SvelteKit を使って jamband/tapes を作った ･ lumieres/legeres"/><meta property="og:description" content="jamband/tapes をリリースした。この記事では jamband/tapes の技術的なことについて書いていく。"/><meta property="og:url" content="https://elle-et-noire.github.io/blog-tsxsample2/2021/10/jamband-tapes-with-sveltekit"/><meta name="next-head-count" content="7"/><link rel="preload" href="/blog/_next/static/css/966f2184015dba7b.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/966f2184015dba7b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/blog/_next/static/chunks/webpack-1a86524882c82c68.js" defer=""></script><script src="/blog/_next/static/chunks/framework-6e4ba497ae0c8a3f.js" defer=""></script><script src="/blog/_next/static/chunks/main-d15cff072e078a2b.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-5e9b2f1eb60e7b0c.js" defer=""></script><script src="/blog/_next/static/chunks/919-231013f5e47261ba.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-3d0d7b5b21b5a35b.js" defer=""></script><script src="/blog/_next/static/fljwOa0DoVzI9yw59I1f1/_buildManifest.js" defer=""></script><script src="/blog/_next/static/fljwOa0DoVzI9yw59I1f1/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/fljwOa0DoVzI9yw59I1f1/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="flex flex-col min-h-screen"><header><nav class="fixed w-full py-3 z-20 text-center font-semibold bg-gray-800" aria-label="Header navigation"><a class="px-5 py-3 no-underline font-mono tracking-tight" href="/blog/"><span class="text-xs text-gray-100 duration-1000">lumieres<!-- -->/</span><span class="text-pink-500 opacity-80 duration-1000">legeres</span></a></nav></header><main class="flex-grow container mx-auto pt-28 pb-10"><div class="style_initial__lfW24" role="status"></div><div><article><header class="mb-8"><h1 class="mb-10">SvelteKit を使って jamband/tapes を作った</h1><div class="italic text-right text-sm text-gray-400"><time dateTime="2021-10-16">Oct 16, 2021</time></div></header><div class="post">
<h2>はじめに</h2>
<p><a href="https://jamband.github.io/tapes/" target="_blank" rel="nofollow noopener noreferrer">jamband/tapes</a> をリリースした。この記事では jamband/tapes の技術的なことについて書いていく。</p>
<h2>環境</h2>
<ul>
  <li>Host: GitHub Pages</li>
  <li>Framework: SvelteKit Beta</li>
  <li>CSS: TailwindCSS</li>
</ul>
<h2>jamband/tapes とは何か</h2>
<p>GitHub Pages 上で動作する SvelteKit を使った Jamstack 構成の音楽サイト。</p>
<p>自分は趣味で <a href="https://plusarchive.com" target="_blank" rel="nofollow noopener noreferrer">PlusArchive</a> というサイトを持っていて、トップページに表示される Recent favorite tracks というものがある。これはだいたい月 1 で更新しているものだが、過去のものはアーカイブとして残らないので、ちょっともったいないなぁと思い、そのアーカイブを「テープ」と名付けた jamband/tapes を作った。</p>
<p>jamband というのは自分の GitHub のアカウント名であり、このブログも GitHub Pages 上で動作していて名前が jamband/blog なので、それに合わせた名前になる。</p>
<h2>更新頻度とコンテンツの量について</h2>
<p>Jamstack 構成で気になるのはまず更新頻度とコンテンツの量。更新頻度については基本月 1 なので問題はなく、月 1 で 1 つのテープが作られ、おおよそ 6 つ程度のそのテープに関連するトラックが追加される。</p>
<p>テープとトラックはそれぞれユニークなページを持っているので、コンテンツの量としては月 7 ページずつ増加する。1 年だと 84 ページになり、10 年だと 840 ページになる。20 年だと 1680 ページになる。</p>
<h2>採用したフレームワークについて</h2>
<p>安定の Next.js さんでもいいわけだが (Incremental Static Regeneration もあるし)、最近自分は SvelteKit をよく触っていたので、それを採用した。また、データについては外部 CMS を使わず JSON 形式のファイルを同レポジトリに持つ構成になっている。</p>
<p>懸念点としては Node.js によるファイル操作でデータを引っ張ってくるので、例えばコンテンツが増えてページネーションを実装したいなぁってときに自分でいろいろ書かなくちゃいけなかったり、コンテンツの量がどのくらい増えたらファイル操作のパフォーマンスに影響するのかを深くは把握していないので、若干の不安はあるが、ファイル操作自体は読み込みのみだけだし、コンテンツの量も急に想定外に増加することはないので、見せ方をちょっと工夫すればなんとかなるだろうと思っている。</p>
<h2>JSON 形式によるデータ (テープ) の生成について</h2>
<p>JSON 形式によるテープのデータは PlusArchive の <a href="https://github.com/jamband/api.plusarchive.com/blob/main/commands/TapeController.php" target="_blank" rel="nofollow noopener noreferrer">バックエンドのコマンド</a> で自動生成する。生成された JSON 形式のファイルを jamband/tapes の特定のディレクトリに置き、若干の目視を加えながら修正をする (言語によっては slug の生成が完璧ではないため) 。</p>
<p>結果として半自動になるわけだが、そこは潔く諦めつつ、少しずつ改善していく。</p>
<h2>現状の SvelteKit について</h2>
<p>SvelteKit は 2021 年 10 月現在まだ Beta であり、安定版に向けて着実に進んではいるものの、やはりまだ安定はしていない。わりと致命的なバグがあったり、アップデートしたら壊れたってこともたまにある。もちろん Beta なので Breaking Change も発生するし、<a href="https://vitejs.dev/" target="_blank" rel="nofollow noopener noreferrer">Vite</a> 関連の問題も多そうで大変そうではあるが、「使える箇所で使ってみつつ様子を見る」程度には使えるのでガンガン使っていきたい。</p>
<p>問題や変更箇所は <a href="https://github.com/sveltejs/kit/issues" target="_blank" rel="nofollow noopener noreferrer">Issues</a> であったり、<a href="https://github.com/sveltejs/kit#packages" target="_blank" rel="nofollow noopener noreferrer">各パッケージの ChangeLog</a> であったりで確認できる。</p>
<h2>テストについて</h2>
<p>Svelte/SvelteKit のコンポーネントのテストは <a href="https://jestjs.io/" target="_blank" rel="nofollow noopener noreferrer">Jest</a> + <a href="https://github.com/mihar-22/svelte-jester" target="_blank" rel="nofollow noopener noreferrer">svelte-jester</a> + <a href="https://github.com/testing-library/svelte-testing-library" target="_blank" rel="nofollow noopener noreferrer">Svelte Testing Library</a> の組み合わせで書くのが良いと思われるが、現状まだ slot のテストができないみたいで (<a href="https://github.com/testing-library/svelte-testing-library/issues/48#issuecomment-707338500" target="_blank" rel="nofollow noopener noreferrer">ハックすればできなくもない</a>) 、絶望して書くのをやめた。ここはもう少し様子を見ようと思う。</p>
<h2>まとめ</h2>
<p>この記事ではコードを 1 つも書いてないが、以下の関連リンクで jamband/tapes のコードを確認できるので、気になる人はどうぞ (fetch 部分にバグがあって変なハックをしていたりするがそのうち修正されると思われる) 。</p>
<h2>関連リンク</h2>
<ul>
  <li><a href="https://kit.svelte.dev/" target="_blank" rel="nofollow noopener noreferrer">SvelteKit</a></li>
  <li><a href="https://jamband.github.io/tapes/" target="_blank" rel="nofollow noopener noreferrer">jamband/tapes</a></li>
  <li><a href="https://github.com/jamband/tapes/" target="_blank" rel="nofollow noopener noreferrer">GitHub: jamband/tapes</a></li>
</ul><script>
MathJax = {
        loader: {load: ['[tex]/physics', '[tex]/mathtools', '[tex]/color', '[tex]/upgreek', '[tex]/centernot']},
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          packages: { '[+]': ['physics', 'mathtools', 'color', 'upgreek', 'centernot'] },
          color: {
            padding: '5px',
            borderWidth: '2px',
          },
          macros: {
            parn: ["\\biggl(#1\\biggr)", 1],
            sqbr: ["\\biggl[#1\\biggr]", 1],
            pfrac: ["\\biggl(\\dfrac{#1}{#2}\\biggr)", 2],
            ds: "\\displaystyle",
            C: '{\\mathbb C}',
            R: '{\\mathbb R}',
            Q: '{\\mathbb Q}',
            Z: '{\\mathbb Z}',
            ssqrt: ['\\sqrt{\\smash[b]{\\mathstrut #1}}', 1],
            tcdegree: ['\\unicode{xb0}'],
            tccelsius: ['\\unicode{x2103}'],
            tcperthousand: ['\\unicode{x2030}'],
            tcmu: ['\\unicode{x3bc}'],
            tcohm: ['\\unicode{x3a9}'],
            bm: ['\\boldsymbol{#1}', 1],
            ol: ['\\overline{#1}', 1],
            ul: ['\\underline{#1}', 1],
            ub: ['\\underbrace{#1}', 1],
            ubt: ['\\underbrace{#1}_{\\text{#2}}', 2],
            i: '{\\mathrm{i}}',
            e: '{\\mathrm{e}}',
            ve: '{\\varepsilon}',
            slashed: ['{{#1\\!\\!\\!/}}', 1],
          },
          physics: {
            italicdiff: true,
            arrowdel: false,
          },
          tags: 'ams',
          tagSide: 'right',
          tagIndent: '0.8em',
          processRefs: true,
        },
        svg: {
          fontCache: 'global'
        },
        chtml: {
          displayAlign: 'left',
          displayIndent: '2em',
          mtextInheritFont: true,
        }
      };
</script>
<script id="MathJax-script"
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
</div><p class="mt-16 text-center"><a class="px-5 py-3 font-semibold" href="/blog/">Home</a></p></article></div></main><div class="mb-3 font-semibold text-center text-xs text-gray-500">© 2022 Tomoki Morita</div><footer class="py-3 text-center font-semibold bg-gray-800"><nav class="text-sm" aria-label="Footer navigation"><a class="px-5 py-3" href="/blog/about/">About</a><a class="px-5 py-3" href="/blog/contact/">Contact</a></nav></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"SvelteKit を使って jamband/tapes を作った","date":"2021-10-16","tags":["github","svelte","sveltekit"],"year":"2021","month":"10","slug":"jamband-tapes-with-sveltekit","content":"\n\u003ch2\u003eはじめに\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://jamband.github.io/tapes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ejamband/tapes\u003c/a\u003e をリリースした。この記事では jamband/tapes の技術的なことについて書いていく。\u003c/p\u003e\n\u003ch2\u003e環境\u003c/h2\u003e\n\u003cul\u003e\n  \u003cli\u003eHost: GitHub Pages\u003c/li\u003e\n  \u003cli\u003eFramework: SvelteKit Beta\u003c/li\u003e\n  \u003cli\u003eCSS: TailwindCSS\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003ejamband/tapes とは何か\u003c/h2\u003e\n\u003cp\u003eGitHub Pages 上で動作する SvelteKit を使った Jamstack 構成の音楽サイト。\u003c/p\u003e\n\u003cp\u003e自分は趣味で \u003ca href=\"https://plusarchive.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ePlusArchive\u003c/a\u003e というサイトを持っていて、トップページに表示される Recent favorite tracks というものがある。これはだいたい月 1 で更新しているものだが、過去のものはアーカイブとして残らないので、ちょっともったいないなぁと思い、そのアーカイブを「テープ」と名付けた jamband/tapes を作った。\u003c/p\u003e\n\u003cp\u003ejamband というのは自分の GitHub のアカウント名であり、このブログも GitHub Pages 上で動作していて名前が jamband/blog なので、それに合わせた名前になる。\u003c/p\u003e\n\u003ch2\u003e更新頻度とコンテンツの量について\u003c/h2\u003e\n\u003cp\u003eJamstack 構成で気になるのはまず更新頻度とコンテンツの量。更新頻度については基本月 1 なので問題はなく、月 1 で 1 つのテープが作られ、おおよそ 6 つ程度のそのテープに関連するトラックが追加される。\u003c/p\u003e\n\u003cp\u003eテープとトラックはそれぞれユニークなページを持っているので、コンテンツの量としては月 7 ページずつ増加する。1 年だと 84 ページになり、10 年だと 840 ページになる。20 年だと 1680 ページになる。\u003c/p\u003e\n\u003ch2\u003e採用したフレームワークについて\u003c/h2\u003e\n\u003cp\u003e安定の Next.js さんでもいいわけだが (Incremental Static Regeneration もあるし)、最近自分は SvelteKit をよく触っていたので、それを採用した。また、データについては外部 CMS を使わず JSON 形式のファイルを同レポジトリに持つ構成になっている。\u003c/p\u003e\n\u003cp\u003e懸念点としては Node.js によるファイル操作でデータを引っ張ってくるので、例えばコンテンツが増えてページネーションを実装したいなぁってときに自分でいろいろ書かなくちゃいけなかったり、コンテンツの量がどのくらい増えたらファイル操作のパフォーマンスに影響するのかを深くは把握していないので、若干の不安はあるが、ファイル操作自体は読み込みのみだけだし、コンテンツの量も急に想定外に増加することはないので、見せ方をちょっと工夫すればなんとかなるだろうと思っている。\u003c/p\u003e\n\u003ch2\u003eJSON 形式によるデータ (テープ) の生成について\u003c/h2\u003e\n\u003cp\u003eJSON 形式によるテープのデータは PlusArchive の \u003ca href=\"https://github.com/jamband/api.plusarchive.com/blob/main/commands/TapeController.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eバックエンドのコマンド\u003c/a\u003e で自動生成する。生成された JSON 形式のファイルを jamband/tapes の特定のディレクトリに置き、若干の目視を加えながら修正をする (言語によっては slug の生成が完璧ではないため) 。\u003c/p\u003e\n\u003cp\u003e結果として半自動になるわけだが、そこは潔く諦めつつ、少しずつ改善していく。\u003c/p\u003e\n\u003ch2\u003e現状の SvelteKit について\u003c/h2\u003e\n\u003cp\u003eSvelteKit は 2021 年 10 月現在まだ Beta であり、安定版に向けて着実に進んではいるものの、やはりまだ安定はしていない。わりと致命的なバグがあったり、アップデートしたら壊れたってこともたまにある。もちろん Beta なので Breaking Change も発生するし、\u003ca href=\"https://vitejs.dev/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eVite\u003c/a\u003e 関連の問題も多そうで大変そうではあるが、「使える箇所で使ってみつつ様子を見る」程度には使えるのでガンガン使っていきたい。\u003c/p\u003e\n\u003cp\u003e問題や変更箇所は \u003ca href=\"https://github.com/sveltejs/kit/issues\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eIssues\u003c/a\u003e であったり、\u003ca href=\"https://github.com/sveltejs/kit#packages\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e各パッケージの ChangeLog\u003c/a\u003e であったりで確認できる。\u003c/p\u003e\n\u003ch2\u003eテストについて\u003c/h2\u003e\n\u003cp\u003eSvelte/SvelteKit のコンポーネントのテストは \u003ca href=\"https://jestjs.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eJest\u003c/a\u003e + \u003ca href=\"https://github.com/mihar-22/svelte-jester\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003esvelte-jester\u003c/a\u003e + \u003ca href=\"https://github.com/testing-library/svelte-testing-library\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eSvelte Testing Library\u003c/a\u003e の組み合わせで書くのが良いと思われるが、現状まだ slot のテストができないみたいで (\u003ca href=\"https://github.com/testing-library/svelte-testing-library/issues/48#issuecomment-707338500\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eハックすればできなくもない\u003c/a\u003e) 、絶望して書くのをやめた。ここはもう少し様子を見ようと思う。\u003c/p\u003e\n\u003ch2\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eこの記事ではコードを 1 つも書いてないが、以下の関連リンクで jamband/tapes のコードを確認できるので、気になる人はどうぞ (fetch 部分にバグがあって変なハックをしていたりするがそのうち修正されると思われる) 。\u003c/p\u003e\n\u003ch2\u003e関連リンク\u003c/h2\u003e\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://kit.svelte.dev/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eSvelteKit\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://jamband.github.io/tapes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ejamband/tapes\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/jamband/tapes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eGitHub: jamband/tapes\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\u003cscript\u003e\nMathJax = {\n        loader: {load: ['[tex]/physics', '[tex]/mathtools', '[tex]/color', '[tex]/upgreek', '[tex]/centernot']},\n        tex: {\n          inlineMath: [['$', '$'], ['\\\\(', '\\\\)']],\n          packages: { '[+]': ['physics', 'mathtools', 'color', 'upgreek', 'centernot'] },\n          color: {\n            padding: '5px',\n            borderWidth: '2px',\n          },\n          macros: {\n            parn: [\"\\\\biggl(#1\\\\biggr)\", 1],\n            sqbr: [\"\\\\biggl[#1\\\\biggr]\", 1],\n            pfrac: [\"\\\\biggl(\\\\dfrac{#1}{#2}\\\\biggr)\", 2],\n            ds: \"\\\\displaystyle\",\n            C: '{\\\\mathbb C}',\n            R: '{\\\\mathbb R}',\n            Q: '{\\\\mathbb Q}',\n            Z: '{\\\\mathbb Z}',\n            ssqrt: ['\\\\sqrt{\\\\smash[b]{\\\\mathstrut #1}}', 1],\n            tcdegree: ['\\\\unicode{xb0}'],\n            tccelsius: ['\\\\unicode{x2103}'],\n            tcperthousand: ['\\\\unicode{x2030}'],\n            tcmu: ['\\\\unicode{x3bc}'],\n            tcohm: ['\\\\unicode{x3a9}'],\n            bm: ['\\\\boldsymbol{#1}', 1],\n            ol: ['\\\\overline{#1}', 1],\n            ul: ['\\\\underline{#1}', 1],\n            ub: ['\\\\underbrace{#1}', 1],\n            ubt: ['\\\\underbrace{#1}_{\\\\text{#2}}', 2],\n            i: '{\\\\mathrm{i}}',\n            e: '{\\\\mathrm{e}}',\n            ve: '{\\\\varepsilon}',\n            slashed: ['{{#1\\\\!\\\\!\\\\!/}}', 1],\n          },\n          physics: {\n            italicdiff: true,\n            arrowdel: false,\n          },\n          tags: 'ams',\n          tagSide: 'right',\n          tagIndent: '0.8em',\n          processRefs: true,\n        },\n        svg: {\n          fontCache: 'global'\n        },\n        chtml: {\n          displayAlign: 'left',\n          displayIndent: '2em',\n          mtextInheritFont: true,\n        }\n      };\n\u003c/script\u003e\n\u003cscript id=\"MathJax-script\"\n  src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js\"\u003e\n\u003c/script\u003e\n"}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2021","month":"10","slug":"jamband-tapes-with-sveltekit"},"buildId":"fljwOa0DoVzI9yw59I1f1","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>